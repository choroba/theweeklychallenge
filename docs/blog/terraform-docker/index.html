<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="Terraform with Docker"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://theweeklychallenge.org/blog/terraform-docker/"/>
    <meta property="og:image"       content="https://theweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="Discussion about Terraform with Docker."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://theweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Discussion about Terraform with Docker.">
    <meta name="author" content="The Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.67.0-DEV" />

    <link rel="me" href="https://fosstodon.org/@manwar">
    <link rel="canonical" href="https://theweeklychallenge.org/blog/terraform-docker/" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Terraform with Docker</title>
    <link rel="icon" href="https://theweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source Code Pro' rel='stylesheet'>
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://theweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://theweeklychallenge.org/css/main.css">

    <style>
        #goTopButton {
            display: none;          
            position: fixed;        
            bottom: 20px;           
            right: 30px;            
            z-index: 99;            
            border: none;           
            outline: none;          
            background-color: red;  
            color: white;           
            cursor: pointer;        
            padding: 15px;          
            border-radius: 10px;    
            font-size: 18px;        
        }

        #goTopButton:hover {
              background-color: #555;
        }
    </style>


</head>

<body>

<button onclick="goTop()" id="goTopButton" title="Go to top">Top</button>

<script>

    topButton = document.getElementById("goTopButton");

    
    window.onscroll = function() { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 40 || document.documentElement.scrollTop > 40) {
            topButton.style.display = "block";
        } else {
            topButton.style.display = "none";
        }
    }

    
    function goTop() {
        document.body.scrollTop = 0; 
        document.documentElement.scrollTop = 0; 
    }

</script>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://theweeklychallenge.org/">
                        <img src="https://theweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Terraform with Docker</h2>
                    <div class="portfolio-meta">
                        <span>Sunday, Mar 23, 2025</span>|
                        <span> Tags:
                            Terraform, Docker
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://theweeklychallenge.org/images/blog/terraform-docker.png">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    <h4 id="disclaimer-image-is-generated-using-free-version-of-chatgpt"><strong>DISCLAIMER:</strong> Image is generated using <code>FREE</code> version of <code>ChatGPT</code>.</h4>
<hr>
<br>
<div class="container">
    <div class="row g-4 justify-content-center">
        <div class="col-12 col-sm mb-4 p-2 text-center">
            <a href="/blog/docker-secret" title="Docker Secret">
                <img src="/images/blog/docker-secret-mini.png" class="img-fluid"
                style="object-fit: cover; aspect-ratio: 16/9;">
            </a>
        </div>
        <div class="col-12 col-sm mb-4 p-2 text-center">
            <a href="/blog/docker-compose" title="Docker Compose">
                <img src="/images/blog/docker-compose-mini.png" class="img-fluid"
                style="object-fit: cover; aspect-ratio: 16/9;">
            </a>
        </div>
        <div class="col-12 col-sm mb-4 p-2 text-center">
            <a href="/blog/docker-volume" title="Docker Volume">
                <img src="/images/blog/docker-volume-mini.png" class="img-fluid"
                style="object-fit: cover; aspect-ratio: 16/9;">
            </a>
        </div>
        <div class="col-12 col-sm mb-4 p-2 text-center">
            <a href="/blog/build-docker-image" title="Build Docker Image">
                <img src="/images/blog/build-docker-image-mini.png" class="img-fluid"
                style="object-fit: cover; aspect-ratio: 16/9;">
            </a>
        </div>
    </div>
</div>
<br>
<h2 id="terraform-with-docker">Terraform with Docker</h2>
<hr>
<h3 id="1-introductionintroduction"><a href="#introduction">1. Introduction</a></h3>
<h3 id="2-objectivesobjectives"><a href="#objectives">2. Objectives</a></h3>
<h3 id="3-what-is-terraformwhat-is-terraform"><a href="#what-is-terraform">3. What is Terraform?</a></h3>
<h3 id="4-why-terraformwhy-terraform"><a href="#why-terraform">4. Why Terraform?</a></h3>
<h3 id="5-terraform-configuration-fileterraform-configuration-file"><a href="#terraform-configuration-file">5. Terraform Configuration File</a></h3>
<h3 id="6-terraform-workflowterraform-workflow"><a href="#terraform-workflow">6. Terraform Workflow</a></h3>
<h3 id="7-setupsetup"><a href="#setup">7. Setup</a></h3>
<h3 id="8-actionaction"><a href="#action">8. Action</a></h3>
<h3 id="9-cleanupcleanup"><a href="#cleanup">9. Cleanup</a></h3>
<br>
<h2 id="introduction">Introduction</h2>
<hr>
<p>A few days ago, I shared my story about creating a <code>Docker</code> image for <a href="https://theweeklychallenge.org"><strong>The Weekly Challenge</strong></a> website in this <a href="https://theweeklychallenge.org/blog/build-docker-image"><strong>blog post</strong></a>.</p>
<p>It was a great learning experience for me, I had never done it before.</p>
<p>Recently at work, I got the opportunity to work with <code>Terraform</code>.</p>
<p>Once again, it was my first time using it.</p>
<p>I decided to learn the basics of <code>Terraform</code> so that at least I understand what I&rsquo;m doing.</p>
<br>
<h2 id="objectives">Objectives</h2>
<hr>
<p>The plan is to familiarise myself with <code>Terraform</code> and then use the tool to build the <code>Docker</code> image for <code>The Weekly Challenge</code> website.</p>
<p>Sounds easy, right?</p>
<p>Not for me, at least not yet, but we will see.</p>
<br>
<h2 id="what-is-terraform">What is Terraform?</h2>
<hr>
<p><code>Terraform</code> is an open-source <code>Infrastructure as Code (IaC)</code> tool developed by <code>HashiCorp</code>.</p>
<p>It allows you to define, provision and manage infrastructure using a declarative configuration language.</p>
<p>Not bad so far.</p>
<br>
<h2 id="why-terraform">Why Terraform?</h2>
<hr>
<p>It automates infrastructure, eliminating manual steps.</p>
<p>It supports various cloud providers e.g. <code>AWS</code>, <code>Azure</code>.</p>
<p>It follows a declarative approach i.e. we define what we want and it figures out how to do it.</p>
<p>It also keeps track of the infrastructure state.</p>
<p>Last but not least, it automatically handles dependencies.</p>
<p>That&rsquo;s enough reason for me to give <code>Terraform</code> a try.</p>
<p>How about you?</p>
<br>
<h2 id="terraform-configuration-file">Terraform Configuration File</h2>
<hr>
<p><code>Terraform</code> uses <code>HCL (HashiCorp Configuration Language)</code> to define infrastructure.</p>
<p>The most commonly used configuration file: <code>main.tf</code></p>
<br>
<h2 id="terraform-workflow">Terraform Workflow</h2>
<hr>
<pre><code>1. Initialise             : terraform init
2. Preview Changes        : terraform plan
3. Apply Configuration    : terraform apply
4. Destroy Infrastructure : terraform destroy
</code></pre>
<p>Terraform tracks infrastructure using a state file: <code>terraform.tfstate</code></p>
<br>
<h2 id="setup">Setup</h2>
<hr>
<p>Since, I&rsquo;m doing this for the first time, I had to setup my environment.</p>
<p>On my personal laptop, running <code>Ubuntu 24.04.1 LTS</code> under <code>WSL2</code>, here is what I did.</p>
<br>
<pre><code>$ wget -O - https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg

$ echo &quot;deb [arch=$(dpkg \
  --print-architecture) \
  --signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] \
  https://apt.releases.hashicorp.com \
  $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/hashicorp.list

$ sudo apt update &amp;&amp; sudo apt install terraform
</code></pre>
<br>
<p>Test the installation:</p>
<br>
<pre><code>$ terraform --version
Terraform v1.11.2
on linux_amd64
</code></pre>
<br>
<p>I already have <code>Docker</code> on my machine, so I skipped that bit.</p>
<p>But in case you need it, please find the instructions below:</p>
<br>
<pre><code>$ sudo apt update
$ sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
$ sudo usermod -aG docker $USER
$ docker --version
</code></pre>
<br>
<h2 id="action">Action</h2>
<hr>
<p>Time for some real action.</p>
<p>I am going to create my <code>Terraform</code> configuration file: <code>main.tf</code> in the <a href="https://github.com/manwar/theweeklychallenge"><strong>GItHub repository</strong></a> where I already have the <a href="https://github.com/manwar/theweeklychallenge/blob/master/Dockerfile"><strong>Dockerfile</strong></a> saved.</p>
<p>Here is my basic configuration file:</p>
<pre><code># Configure the Docker provider
terraform {
  required_providers {
    docker = {
      source = &quot;kreuzwerker/docker&quot;
      version = &quot;3.0.2&quot;
    }
  }
}

# Define the Docker image to be built
resource &quot;docker_image&quot; &quot;theweeklychallenge&quot; {
  name = &quot;theweeklychallenge:latest&quot;
  build {
    context = &quot;.&quot;
    tag     = [&quot;theweeklychallenge:latest&quot;]
  }
}

# Output the image ID after creation
output &quot;image_id&quot; {
  value = docker_image.theweeklychallenge.image_id
}
</code></pre><br>
<p>Let&rsquo;s start the process.</p>
<p>As soon as I fired the first command: <code>terraform init</code>, I encountered the following error:</p>
<br>
<pre><code>Error loading shared library libstdc++.so.6: No such file or directory (needed by /theweeklychallenge/bin/hugo)
Error loading shared library libgcc_s.so.1: No such file or directory (needed by /theweeklychallenge/bin/hugo)
</code></pre>
<br>
<p>It turned out that my <code>Dockerfile</code> was missing some libraries: <code>libstdc++</code>, <code>libgcc</code></p>
<p>So I updated the <code>Dockerfile</code> and now it looks like below:</p>
<br>
<pre><code>FROM alpine:latest
LABEL maintainer=&quot;mohammad.anwar@yahoo.com&quot;

RUN apk add --no-cache libc6-compat
RUN apk add --no-cache libstdc++ libgcc

WORKDIR /theweeklychallenge
COPY . /theweeklychallenge

EXPOSE 1414
CMD [&quot;bin/hugo&quot;, &quot;server&quot;, &quot;-p&quot;, &quot;1414&quot;, &quot;-D&quot;, &quot;--bind&quot;, &quot;0.0.0.0&quot;]
</code></pre><br>
<p>Let&rsquo;s re-run the command:</p>
<br>
<pre><code>$ terraform init
Initializing the backend...
Initializing provider plugins...
- Finding kreuzwerker/docker versions matching &quot;3.0.2&quot;...
- Installing kreuzwerker/docker v3.0.2...
- Installed kreuzwerker/docker v3.0.2 (self-signed, key ID BD080C4571C6104C)
Partner and community providers are signed by their developers.
If you'd like to know more about provider signing, you can read about it here:
https://www.terraform.io/docs/cli/plugins/signing.html
Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run &quot;terraform init&quot; in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
</code></pre>
<br>
<p>So far so good, passed the init stage.</p>
<p>Now move to next stage:</p>
<br>
<pre><code>$ terraform apply
...
...
...
docker_image.theweeklychallenge: Creating...
...
...
Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:
image_id = &quot;sha256:055c55d698c6455c108ead190cbd06773066c3d50dc9eceb673a006a785a4a75&quot;
</code></pre>
<br>
<p>Cool, the <code>Docker</code> image has been created.</p>
<p>Let&rsquo;s verify that:</p>
<br>
<pre><code>$ docker images
REPOSITORY                      TAG       IMAGE ID       CREATED         SIZE
theweeklychallenge              latest    055c55d698c6   5 seconds ago   1.09GB
</code></pre>
<br>
<p>Indeed, we now have a <code>Docker</code> image.</p>
<p>Let&rsquo;s run the container now:</p>
<br>
<pre><code>$ docker run\
--name theweeklychallenge \
-p 1414:1414 \
-d theweeklychallenge:latest
06a5f07b26dcc1909ffa837ab507483892cf7daf2b2bd673ba50c0793e0d86de
</code></pre>
<hr>
<br>
<p>We will check the status of container:</p>
<br>
<pre><code>$ dps
Container ID: 06a5f07b26dc
Image: theweeklychallenge:latest
Command: &quot;bin/hugo server -p …&quot;
Created: 2025-03-23 05:09:04 +0000 GMT
Status: Up 6 seconds
Ports: 0.0.0.0:1414-&gt;1414/tcp, [::]:1414-&gt;1414/tcp
</code></pre>
<br>
<p><code>dps</code> is the alias. I created earlier for nice formatted output of the command: <code>docker ps</code>.</p>
<br>
<pre><code>alias dps='docker ps --format &quot;Container ID: {{.ID}}\nImage: {{.Image}}\nCommand: {{.Command}}\nCreated: {{.CreatedAt}}\nStatus: {{.Status}}\nPorts: {{.Ports}}\nNames: {{.Names}}\n&quot;'
</code></pre>
<br>
<p>Time to access the weekly challenge site running inside the container using the image built by <code>Terraform</code>:</p>
<p><code>http://localhost:1414</code></p>
<p>I got lucky, everything works fine.</p>
<br>
<h2 id="cleanup">Cleanup</h2>
<hr>
<p>Let&rsquo;s do the cleaning.</p>
<p>We need to stop the container and then remove it too first.</p>
<br>
<pre><code>$ docker stop theweeklychallenge
theweeklychallenge
$ docker rm theweeklychallenge
theweeklychallenge
</code></pre>
<br>
<p>Now we will ask, <code>Terraform</code> to do the destruction for me.</p>
<br>
<pre><code>$ terraform destroy
...
...
docker_image.theweeklychallenge: Destruction complete after 0s
Destroy complete! Resources: 1 destroyed.
</code></pre>
<br>
<p>However I still see some leftovers.</p>
<p>So I did the manually cleaning:</p>
<br>
<pre><code>$ rm -rf .terraform/ terraform.tfstate* .terraform.lock.hcl
</code></pre>
<br>
<p>Everything back to original state. I hope you had fun with me in this journey.</p>
<hr>
<p><code>Keep Hacking !!</code></p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="mailto:mohammad.anwar@yahoo.com" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        2019 - 2025
                    </span> The Weekly Challenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" rel="noreferrer" rel="noreferrer" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" rel="noreferrer" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://theweeklychallenge.org/plugins/jquery/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://theweeklychallenge.org/plugins/form-validation/jquery.form.min.js"></script>
<script src="https://theweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://theweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://theweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://theweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/chart.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/pwc-challenge.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/gc-challenge.js"></script>
<!-- wow js -->
<script src="https://theweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://theweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://theweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://theweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CJTPYM9SB8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CJTPYM9SB8');
</script>
</body>

</html>

