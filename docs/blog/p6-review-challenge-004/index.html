<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="The Weekly Challenge"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://theweeklychallenge.org/"/>
    <meta property="og:image"       content="https://theweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://theweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Laurent Rosenfeld Weekly Review: Challenge - #004.">
    <meta name="author" content="The Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.67.0-DEV" />

    <link rel="me" href="https://fosstodon.org/@manwar">

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Laurent Rosenfeld Weekly Review: Challenge - 004</title>
    <link rel="icon" href="https://theweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source Code Pro' rel='stylesheet'>
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://theweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://theweeklychallenge.org/css/main.css">

    <style>
        #goTopButton {
            display: none;          
            position: fixed;        
            bottom: 20px;           
            right: 30px;            
            z-index: 99;            
            border: none;           
            outline: none;          
            background-color: red;  
            color: white;           
            cursor: pointer;        
            padding: 15px;          
            border-radius: 10px;    
            font-size: 18px;        
        }

        #goTopButton:hover {
              background-color: #555;
        }
    </style>


</head>

<body>

<button onclick="goTop()" id="goTopButton" title="Go to top">Top</button>

<script>

    topButton = document.getElementById("goTopButton");

    
    window.onscroll = function() { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 40 || document.documentElement.scrollTop > 40) {
            topButton.style.display = "block";
        } else {
            topButton.style.display = "none";
        }
    }

    
    function goTop() {
        document.body.scrollTop = 0; 
        document.documentElement.scrollTop = 0; 
    }

</script>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://theweeklychallenge.org/">
                        <img src="https://theweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Laurent Rosenfeld Weekly Review: Challenge - 004</h2>
                    <div class="portfolio-meta">
                        <span>Sunday, Nov 10, 2019</span>|
                        <span> Tags:
                            Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://theweeklychallenge.org/images/blog/p6-review-challenge-004.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    <hr>
<h1 id="raku-solutions-weekly-review">Raku Solutions Weekly Review</h1>
<hr>
<h2 id="task-1-computing-the-digits-of-pi">Task #1: Computing the Digits of Pi</h2>
<p>This is derived in part from my <a href="http://blogs.perl.org/users/laurent_r/2019/04/perl-weekly-challenge-week-4.html">blog post</a> made in answer to the <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-004/">Week 04 of the Perl Weekly Challenge</a> organized by  <a href="http://blogs.perl.org/users/mohammad_s_anwar/">Mohammad S. Anwar</a> as well as answers made by others to the same challenge.</p>
<p>The challenge reads as follows:</p>
<p><em>Write a script to output the same number of PI digits as the size of your script. Say, if your script size is 10, it should print 3.141592653.</em></p>
<h2 id="my-solutions">My Solutions</h2>
<p>Let&rsquo;s start with a simple one-liner satisfying the requirement:</p>
<pre><code>perl6 -e '
print pi, &quot;\n&quot;;
'
3.14159265358979
</code></pre>
<p>So, job done? Well, yes and no. Let&rsquo;s try to be more serious and adapt the size of our output to the size of the script, which means to actually calculate some digits of pi.</p>
<p>I&rsquo;ve tried several formulae known for centuries (François Viète, John Wallis, John Machin, Isaac Newton, Gottfried Wilhelm Leibniz, etc.), but will show only one of them to illustrate the problem.</p>
<p><a href="https://en.wikipedia.org/wiki/Pi#Infinite_series">John Wallis&rsquo;s infinite product</a> can be reformatted as:</p>
<pre><code>pi / 2 = (2 * 2 * 4 * 4 * 6 * 6 * 8 * 8 ... ) / (1 * 3 * 3 * 5 * 5 * 7 * 7 * 9 ...)
</code></pre>
<p>We can build two lazy infinite lists, one for the numerator and one for the denominator and use the reduction operator to calculate Wallis&rsquo;s infinite product:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> @numerators <span style="color:#f92672">=</span>  <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-&gt;</span> $a, $b {<span style="color:#f92672">|</span> ($a <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, $b <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) } <span style="color:#f92672">...</span> <span style="color:#f92672">*</span>;
<span style="color:#66d9ef">my</span> @denominators <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>, <span style="color:#f92672">-&gt;</span> $a, $b {<span style="color:#f92672">|</span> ($a <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, $b <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) } <span style="color:#f92672">...</span> <span style="color:#f92672">*</span>;
<span style="color:#66d9ef">my</span> $pi <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> ([<span style="color:#f92672">*</span>] @numerators[<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">2000</span>]) <span style="color:#f92672">/</span> ([<span style="color:#f92672">*</span>] @denominators[<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">2000</span>]);
</code></pre></div><p>The value obtained for <code>$pi</code> is:</p>
<pre><code>3.14237736509388
</code></pre>
<p>Only the first three digits are correct with a product of two thousands terms! Quite obviously, those century-old formulas converge much too slowly for our purpose. We need something more efficient.</p>
<p>The Indian mathematician Srinivasa Ramanujan is known as the author of a number of innovative new formulae for calculating digits of pi during the first decades of the twentieth century, but the one I looked at is not so easy to implement, notably because it involves the square root of two, so we would need to start by calculating the digits of that number as a <code>FatRat</code>. This is the solution adopted by Doug Schrag (see below in the <em>Alternative Solutions</em> section), but I decided to take another approach.</p>
<p>In 2006, Franco-Canadian mathematician Simon Plouffe used the so-called PSLQ integer relation algorithm to generate several new formulae for pi. One of them was described back in 1995 and is known as <a href="https://en.wikipedia.org/wiki/Pi#Spigot_algorithms">one of the spigot algorithms</a>.</p>
<p>We can write the following <code>plouffe</code> subroutine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">plouffe</span> (Int $k) {
    <span style="color:#66d9ef">my</span> $result <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#e6db74">/ 16 ** $k) * (  (4 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#e6db74">/ (8 * $k + 4)) - (1 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>) )  );
}
</code></pre></div><p>to calculate the individual terms of the infinite sum and then compute pi as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> $pi <span style="color:#f92672">=</span> [<span style="color:#f92672">\+</span>]  (plouffe $_ <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">20</span>);
</code></pre></div><p>That does not work properly, however, as the <code>plouffe</code> terms get converted from rationals to floats (well, really from <code>Rat</code> to <code>Num</code>) when the input value reaches 11 or more, as shown here under the REPL:</p>
<pre><code>&gt; say (plouffe $_).WHAT for 0..15;
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Num)
(Num)
(Num)
(Num)
(Num)
</code></pre>
<p>so that we are losing accuracy and the result:</p>
<pre><code>3.141592653589793129614170564041344859
</code></pre>
<p>is correct only up to the 16th digit.</p>
<p>So, let&rsquo;s try to use the <code>FatRat</code> type:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">plouffe</span> (Int $k) {
    <span style="color:#66d9ef">my</span> $result <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>FatRat <span style="color:#f92672">*</span>  (<span style="color:#ae81ff">1</span> <span style="color:#e6db74">/ 16 ** $k) * (  (4 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#e6db74">/ (8 * $k + 4)) - (1 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>) )  );
}
</code></pre></div><p>It is a bit better, but we are again falling back to <code>Num</code> when the subroutine input value reaches 17 or above:</p>
<pre><code>&gt; say (plouffe $_).WHAT for 0..20;
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(Num)
(Num)
(Num)
(Num)
(Num)
</code></pre>
<p>For some reason, coercing the input value to a <code>FatRat</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">plouffe</span> (FatRat $k) {
    <span style="color:#66d9ef">my</span> $result <span style="color:#f92672">=</span>  (<span style="color:#ae81ff">1</span> <span style="color:#e6db74">/ 16 ** $k) * (  (4 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#e6db74">/ (8 * $k + 4)) - (1 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>) )  );
}
say (plouffe $_<span style="color:#f92672">.</span>FatRat)<span style="color:#f92672">.</span>WHAT <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">20</span>;
</code></pre></div><p>doesn&rsquo;t work either.</p>
<p>While still trying to understand why we are falling from <code>FatRat</code> to <code>Num</code>, I posted a question on <a href="https://www.nntp.perl.org/group/perl.perl6.users/2019/04/msg6664.html">perl6-users</a>, and I quickly received very useful tips from Fernando Santagata and Brian Duggan. Many thanks to them.</p>
<p>The following syntax suggested by Brian works properly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">plouffe</span> (Int $k) {
    <span style="color:#66d9ef">my</span> $result <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>FatRat <span style="color:#e6db74">/ 16 ** $k) * (  (4 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#e6db74">/ (8 * $k + 4)) - (1 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>) )  );
}
<span style="color:#75715e"># printing 200 digits of pi</span>
<span style="color:#66d9ef">my</span> $pi <span style="color:#f92672">=</span> [<span style="color:#f92672">+</span>] (plouffe $_ <span style="color:#66d9ef">for</span>  <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">200</span>);
</code></pre></div><p>Now, <code>$pi</code> is populated with about 750 digits, two thirds of which are wrong, but the important point is that they are all correct up to the 249th digit. In general, we get an average of about 1.2 correct digits per term in the sum. So, with the above input values, we&rsquo;re on the safe side of things if we print out the first two hundred digits under the REPL:</p>
<pre><code>&gt; say substr $pi, 0, 201;
3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819
</code></pre>
<p>It is now fairly easy to output the same number of PI digits as the size of the script:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">plouffe</span> (Int $k) {
    <span style="color:#66d9ef">my</span> $result <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>FatRat <span style="color:#e6db74">/ 16 ** $k) * (  (4 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#e6db74">/ (8 * $k + 4)) - (1 /</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> $k <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>) )  );
}
<span style="color:#66d9ef">my</span> $script<span style="color:#f92672">-</span>size <span style="color:#f92672">=</span> $<span style="color:#960050;background-color:#1e0010">*</span>PROGRAM<span style="color:#f92672">-</span>NAME<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s;
<span style="color:#66d9ef">my</span> $pi <span style="color:#f92672">=</span> [<span style="color:#f92672">+</span>] (plouffe $_ <span style="color:#66d9ef">for</span>  <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>$script<span style="color:#f92672">-</span>size);
say substr $pi, <span style="color:#ae81ff">0</span>, $script<span style="color:#f92672">-</span>size <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#75715e"># +1 because the decimal dot isn&#39;t a digit</span>
</code></pre></div><p>The script has 290 bytes and the script prints the first 290 digits of pi:</p>
<pre><code>$ perl6 pi.p6
3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072
</code></pre>
<p>The script runs in slightly less than 1.5 sec.</p>
<h2 id="alternative-solutions">Alternative Solutions</h2>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/arne-sommer/perl6/ch-1.p6">Arne Sommer</a> provided a solution very similar to my initial one-liner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">say pi<span style="color:#f92672">.</span>fmt(<span style="color:#e6db74">&#39;%.19f&#39;</span>)
</code></pre></div><p>He also suggested <a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/arne-sommer/perl6/say-pi-module">another solution</a> using the following <code>PiXL.pm6</code>module:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">use</span> v6<span style="color:#f92672">.</span>d;

unit module PiXL;

<span style="color:#66d9ef">our</span> constant $PI is export <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989&#34;</span>;
</code></pre></div><p>and then used the module as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">use</span> lib <span style="color:#e6db74">&#34;lib&#34;</span>;
<span style="color:#66d9ef">use</span> PiXL;

say $PI<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>, $<span style="color:#960050;background-color:#1e0010">?</span>FILE<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</code></pre></div><p>The trick is clear: store so many digits of pi as you want in a separate module, since the size of the module will not counted in the script size.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/jo-christian-oterhals/perl6/ch-1.p6">Jo Christian Oterhals</a> used essentially the same trick and first  created the following <code>BigPi.pm6</code> module:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#75715e"># Perl 6 Module BigPI.pm6</span>
<span style="color:#75715e"># Place in script directory and use perl6 with -I flag</span>
<span style="color:#75715e"># i.e. perl6 -I. &lt;calling script&gt;</span>

unit module BigPI;

<span style="color:#75715e"># This definition of PI is taken from the Perl 5 module Math::BigFloat</span>
constant PI <span style="color:#f92672">=</span> join <span style="color:#e6db74">&#39;&#39;</span>, qw:to<span style="color:#e6db74">/END/</span>;
<span style="color:#ae81ff">314159265358979323846264338327950288419716939937510582097494459230781640628</span>
<span style="color:#ae81ff">620899862803482534211706798214808651328230664709384460955058223172535940812</span>
<span style="color:#ae81ff">848111745028410270193852110555964462294895493038196442881097566593344612847</span>
<span style="color:#ae81ff">564823378678316527120190914564856692346034861045432664821339360726024914127</span>
<span style="color:#ae81ff">372458700660631558817488152092096282925409171536436789259036001133053054882</span>
<span style="color:#ae81ff">04665213</span><span style="color:#ae81ff">8414695194151160943305727036575959195309218611738193261179310511854</span>
<span style="color:#ae81ff">807446237996274956735188575272489122793818301194912983367336244065664308602</span>
<span style="color:#ae81ff">139494639522473719070217986094370277053921717629317675238467481846766940513</span>
<span style="color:#ae81ff">200056812714526356082778577134275778960917363717872146844090122495343014654</span>
<span style="color:#ae81ff">958537105079227968925892354201995611212902196086403441815981362977477130996</span>
<span style="color:#ae81ff">051</span><span style="color:#ae81ff">870721134999999837297804995105973173281609631859502445945534690830264252</span>
<span style="color:#ae81ff">230825334468503526193118817101000313783875288658753320838142061717766914730</span>
<span style="color:#ae81ff">359825349042875546873115956286388235378759375195778185778053217122680661300</span>
<span style="color:#ae81ff">192787661119590921642019893809525720106548586327886593615338182796823030195</span>
<span style="color:#66d9ef">END</span>
</code></pre></div><p>and then used it as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">use</span> BigPI;

say BigPI::pi $<span style="color:#960050;background-color:#1e0010">?</span>FILE<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s;
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/joelle-maslak/perl6/ch-1.p6">Joelle Maslak</a> also hard-coded the digits of pi but had the clever idea of using a base-32 representation of pi, thus making the script shorter:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">say <span style="color:#ae81ff">3</span><span style="color:#f92672">~</span><span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">~</span>:<span style="color:#ae81ff">32</span><span style="color:#e6db74">&lt;35IPR975H1E3E2K2GQK0D32I3C1U7N&gt;</span>
</code></pre></div><p>This works properly as shown under the REPL:</p>
<pre><code>&gt; say 3~'.'~:32&lt;35IPR975H1E3E2K2GQK0D32I3C1U7N&gt;
3.141592653589793238462643383279502884197169399
</code></pre>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/doug-schrag/perl6/ch-1.p6">Doug Schrag</a> based his calculation of a formula discovered by Srinivasa Ramanujan:</p>
<p><img src="/images/blog/Ramanujan_pi.png" alt=""></p>
<p>For this, he first implemented a <code>sqrt-rat</code> subroutine to compute a <code>FatRat</code> estimate of the square root of 2:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> $chars <span style="color:#f92672">=</span> $<span style="color:#960050;background-color:#1e0010">*</span>PROGRAM<span style="color:#f92672">.</span>slurp<span style="color:#f92672">.</span>chars;
say pi<span style="color:#f92672">-</span>rat<span style="color:#f92672">.</span>Str<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>,$chars);
say <span style="color:#e6db74">&#34;$chars digits!&#34;</span>;

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">postfix</span>:&lt;!&gt; ($n) { [<span style="color:#f92672">*</span>] <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span>$n }
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">f</span>($k) {
    FatRat<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>: (<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>$k)<span style="color:#f92672">!</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1103</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">26390</span> <span style="color:#f92672">*</span> $k), ($k<span style="color:#f92672">!</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">396</span><span style="color:#f92672">**</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>$k)
}
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">pi</span>-rat () {
    <span style="color:#ae81ff">9801</span> <span style="color:#f92672">*</span> sqrt<span style="color:#f92672">-</span>rat(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1e-500</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>
    <span style="color:#f92672">/</span> [<span style="color:#f92672">+</span>] (<span style="color:#f92672">^</span><span style="color:#ae81ff">80</span>)<span style="color:#f92672">.</span>map: <span style="color:#f92672">*.&amp;</span>f
}

multi <span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">sqrt</span>-rat ($n where * &gt; 0, $eps) {
    <span style="color:#66d9ef">my</span> $base <span style="color:#f92672">=</span> $n<span style="color:#f92672">.</span>FatRat($eps);
    <span style="color:#66d9ef">my</span> $r <span style="color:#f92672">=</span> sqrt($base)<span style="color:#f92672">.</span>FatRat($eps);
    <span style="color:#66d9ef">my</span> $est;
    repeat {
        $est <span style="color:#f92672">=</span> $r;
        $r <span style="color:#f92672">=</span> ($base <span style="color:#e6db74">/ $est + $est) /</span> <span style="color:#ae81ff">2</span>;
    } <span style="color:#66d9ef">while</span> abs($r <span style="color:#f92672">-</span> $est) <span style="color:#f92672">&gt;</span> $eps;

    <span style="color:#66d9ef">return</span> $r;
}
multi <span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">sqrt</span>-rat (0) { <span style="color:#ae81ff">0</span> }
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/fjwhittle/perl6/ch-1.p6">Francis J. Whittle</a> apparently based his computation on the Newton-Euler convergence transformation formula:</p>
<p><img src="/images/blog/Newton-Euler.png" alt=""></p>
<p>where (2k + 1)!! denotes the product of the odd integers up to 2k + 1.</p>
<p>His program first computes a lazy list of the various terms of the sum and then multiplies by two the sum of the 608 first terms:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">my</span> $eu<span style="color:#f92672">-</span>seq <span style="color:#f92672">=</span> gather {
  take <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">..*</span> <span style="color:#f92672">-&gt;</span> $n { take $eu<span style="color:#f92672">-</span>seq[$n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> FatRat<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>($n, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> $n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) }
}

<span style="color:#66d9ef">my</span> <span style="color:#f92672">\</span>π :<span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> [<span style="color:#f92672">+</span>] $eu<span style="color:#f92672">-</span>seq[<span style="color:#f92672">^</span><span style="color:#ae81ff">608</span>];

put π<span style="color:#f92672">.</span>Str<span style="color:#f92672">.</span>substr: <span style="color:#f92672">^</span>($<span style="color:#960050;background-color:#1e0010">?</span>FILE<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/jaldhar-h-vyas/perl6/ch-1.p6">Jaldhar H. Vyas</a> provided a very simple solution using the <code>Rat::Precise</code> module:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#75715e"># Thanks to thundergnat for the module and informing me about it on IRC.</span>
<span style="color:#66d9ef">use</span> Rat::Precise;

<span style="color:#66d9ef">my</span> $size <span style="color:#f92672">=</span>  $<span style="color:#960050;background-color:#1e0010">*</span>PROGRAM<span style="color:#f92672">-</span>NAME<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s;
π<span style="color:#f92672">.</span>FatRat<span style="color:#f92672">.</span>precise($size <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>say; <span style="color:#75715e"># - 1 because 3. is a digit of pi</span>
</code></pre></div><p>I also did not know about that module, so thanks to <em>thundergnat</em> and to Jaldhar for the information.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/james-smith/perl6/ch-1.p6">James A. Smith</a> provided a solution similar to my initial one-liner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">say <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>atan2 <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>;
</code></pre></div><p>Actually, this almost exactly the idea I suggested in my Perl 5 solution.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/nick-logan/perl6/ch-1.p6">Nick Logan</a> submitted a polyglot script, i.e. a script running both in Perl 5 and Perl 6:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#75715e"># WARNING: this polyglot breaks best practices of both Perl 5 and Perl 6 in order to run on both</span>

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">eval</span>($_)      { <span style="color:#f92672">&amp;</span>EVAL($_) };
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">polyint</span>($_)   { <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">and</span> (<span style="color:#66d9ef">return</span> Int($_[<span style="color:#ae81ff">0</span>])) <span style="color:#f92672">or</span> (<span style="color:#66d9ef">return</span> int($_[<span style="color:#ae81ff">0</span>])) };
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">script_size</span>   { <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">and</span> (<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">+</span>eval(<span style="color:#e6db74">&#39;$*PROGRAM.IO.s&#39;</span>)) <span style="color:#f92672">or</span> (<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">+</span>eval(<span style="color:#e6db74">&#39;-s $0&#39;</span>)) };
<span style="color:#75715e">#`() use isms; sub infix:«&lt;&lt;»($a,$b) { $a +&lt; $b };</span>

<span style="color:#66d9ef">my</span> $digits <span style="color:#f92672">=</span> script_size() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
<span style="color:#66d9ef">my</span> (@out, @a);
<span style="color:#66d9ef">my</span> ($b, $c, $d, $e, $f, $g, $i, $d4, $d3, $d2, $d1);

$b <span style="color:#f92672">=</span> $d <span style="color:#f92672">=</span> $e <span style="color:#f92672">=</span> $g <span style="color:#f92672">=</span> $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
$f <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>;
$c <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span> <span style="color:#f92672">*</span> (polyint($digits<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;3.&#34;</span>;
<span style="color:#66d9ef">while</span> (($b <span style="color:#f92672">=</span> $c <span style="color:#f92672">-=</span> <span style="color:#ae81ff">14</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> $i <span style="color:#f92672">&lt;</span> $digits) {
    $d <span style="color:#f92672">=</span> $e <span style="color:#f92672">=</span> $d % <span style="color:#960050;background-color:#1e0010">$</span>f;
    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">--</span>$b <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        $d <span style="color:#f92672">=</span> $d <span style="color:#f92672">*</span> $b <span style="color:#f92672">+</span> (@a[$b] <span style="color:#e6db74">//</span> <span style="color:#ae81ff">20000000</span>);
        $g <span style="color:#f92672">=</span> ($b <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
        @a[$b] <span style="color:#f92672">=</span> ($d % <span style="color:#960050;background-color:#1e0010">$</span>g) <span style="color:#f92672">*</span> $f;
        $d <span style="color:#f92672">=</span> polyint($d <span style="color:#f92672">/</span> $g);
    }
    $d4 <span style="color:#f92672">=</span> $e <span style="color:#f92672">+</span> polyint($d<span style="color:#f92672">/</span>$f);
    <span style="color:#66d9ef">if</span> ($d4 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">9999</span>) {
        $d4 <span style="color:#f92672">-=</span> <span style="color:#ae81ff">10000</span>;
        @out[$i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">++</span>;
        $b <span style="color:#f92672">=</span> $i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
        <span style="color:#66d9ef">while</span> (@out[$b] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
            @out[$b] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
            @out[$b<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">++</span>;
            $b<span style="color:#f92672">--</span>;
        }
    }
    $d3 <span style="color:#f92672">=</span> polyint($d4<span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>);
    $d2 <span style="color:#f92672">=</span> polyint($d3<span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>);
    $d1 <span style="color:#f92672">=</span> polyint($d2<span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>);
    @out[$i<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> $d1;
    @out[$i<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> $d2<span style="color:#f92672">-</span>$d1<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>;
    @out[$i<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> $d3<span style="color:#f92672">-</span>$d2<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>;
    @out[$i<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> $d4<span style="color:#f92672">-</span>$d3<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>;
    <span style="color:#66d9ef">print</span> join <span style="color:#e6db74">&#34;&#34;</span>, @out[$i<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span> <span style="color:#f92672">..</span> $i<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span><span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>] <span style="color:#66d9ef">if</span> $i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">16</span>;
}
<span style="color:#66d9ef">print</span> join <span style="color:#e6db74">&#34;&#34;</span>, @out[$i<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">..</span> $digits<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#34;\n&#34;</span>;
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/rob4t/perl6/ch-1.p6">Rob4t</a> used basically the same idea as in my initial one-liner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6">say π;<span style="color:#75715e">#size 16</span>
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/ruben-westerberg/perl6/ch-1.p6">Ruben Westerberg</a> used, if I understand well, one of the numerous continued fraction formulae:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#75715e">#!/usr/bin/env perl6</span>
<span style="color:#66d9ef">my</span> $places<span style="color:#f92672">=</span> $<span style="color:#960050;background-color:#1e0010">*</span>PROGRAM<span style="color:#f92672">-</span>NAME<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
printf <span style="color:#e6db74">&#34;Places: $places\n&#34;</span>;
<span style="color:#66d9ef">my</span> $prev<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>;
<span style="color:#66d9ef">my</span> $sign;
<span style="color:#66d9ef">my</span> $pi<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>FatRat;
<span style="color:#66d9ef">my</span> $denom<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;
<span style="color:#66d9ef">my</span> $stable<span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">my</span> $i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">my</span> $float;
<span style="color:#66d9ef">until</span> ($stable) {
    $sign<span style="color:#f92672">=</span> (($i %% 2) ?? <span style="color:#ae81ff">4</span>  <span style="color:#f92672">!!</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>);
    $pi<span style="color:#f92672">+=</span>($sign<span style="color:#f92672">/</span>$denom)<span style="color:#f92672">.</span>FatRat;
    $denom<span style="color:#f92672">+=</span><span style="color:#ae81ff">2</span>;
    $i<span style="color:#f92672">++</span>;
    $float<span style="color:#f92672">=</span>$pi<span style="color:#f92672">.</span>Str<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>,$places<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
    say <span style="color:#e6db74">&#34;Iteration: $i, Value of PI (to $places decimal places):$float&#34;</span>;
    $stable<span style="color:#f92672">=</span>$float <span style="color:#f92672">eq</span> $prev;
    $prev<span style="color:#f92672">=</span>$float;
}
</code></pre></div><p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/mark-senn/perl6/ch-1.p6">Mark Senn</a> used the same formula by Simon Plouffe formula as I did:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">plouffe</span> (Int $k)
{
    (<span style="color:#ae81ff">1</span><span style="color:#f92672">.</span>FatRat<span style="color:#f92672">/</span><span style="color:#ae81ff">16</span><span style="color:#f92672">**</span>$k) <span style="color:#f92672">*</span>
    (
          (<span style="color:#ae81ff">4</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>$k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))
        <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>$k <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>))
        <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>$k <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>))
        <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>$k <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>))
    )
}

<span style="color:#75715e"># Get size of the script.</span>
<span style="color:#66d9ef">my</span> $size <span style="color:#f92672">=</span> $<span style="color:#960050;background-color:#1e0010">*</span>PROGRAM<span style="color:#f92672">-</span>NAME<span style="color:#f92672">.</span>IO<span style="color:#f92672">.</span>s;

<span style="color:#75715e"># The value of pi has only been double</span>
<span style="color:#75715e"># checked up to 1000 characters.</span>
<span style="color:#66d9ef">if</span> ($size <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1_000</span>)
{
    die <span style="color:#e6db74">&#34;program not tested for a &#34;</span>
        <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;script size of more than &#34;</span>
        <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;1000 characters&#34;</span>;
}

<span style="color:#66d9ef">my</span> $pi <span style="color:#f92672">=</span> [<span style="color:#f92672">+</span>] (plouffe $_ <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>$size);

say substr($pi, <span style="color:#ae81ff">0</span>, $size);
</code></pre></div><p>Mark acknowledges in his blog post that he was prompted to use this formula by my question on <a href="https://www.nntp.perl.org/group/perl.perl6.users/2019/04/msg6664.html">perl6-users</a> and the answers provided by Fernando Santagata and Brian Duggan.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/simon-proctor/perl6/ch-1.p6">Simon Proctor</a> created a <code>///</code> operator to transform simple division into <code>FatRat</code> constructor and assignment, thus avoiding the <code>Rat</code> falling to <code>Num</code> problem I reported at the beginning of this post. Otherwise, he used the same Plouffe formula as I did:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">infix</span>:&lt;///&gt; ( Int() $nu, Int() $de ) { FatRat<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>( $nu, $de ) }

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">bbp</span>-digit ( Int $k ) {
    <span style="color:#66d9ef">my</span> $k8 <span style="color:#f92672">=</span> $k<span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>;
    (<span style="color:#ae81ff">1</span> <span style="color:#e6db74">/// (16 ** $k)) * ((4 ///</span> ($k8 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">2</span> <span style="color:#e6db74">/// ($k8 + 4)) - (1 ///</span> ($k8 <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">-</span> (<span style="color:#ae81ff">1</span> <span style="color:#e6db74">//</span><span style="color:#f92672">/</span> ($k8<span style="color:#f92672">+</span><span style="color:#ae81ff">6</span>)));
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">calc</span>-pi( Int $num ) {
    <span style="color:#66d9ef">my</span> $p <span style="color:#f92672">=</span> [<span style="color:#f92672">+</span>] ( <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>$num )<span style="color:#f92672">.</span>map( <span style="color:#f92672">&amp;</span>bbp<span style="color:#f92672">-</span>digit );
    <span style="color:#66d9ef">return</span> $p<span style="color:#f92672">.</span>Str<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>,$num<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
}

<span style="color:#75715e">#| Calculate PI to a given number of digits</span>
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">MAIN</span> (
    Int $digits #= Number of digits to calcuate
) {
    say calc<span style="color:#f92672">-</span>pi( $digits );
}
</code></pre></div><p>Simon was also reports in his blog post that he was prompted to use this formula by my question on <a href="https://www.nntp.perl.org/group/perl.perl6.users/2019/04/msg6664.html">perl6-users</a> and the answers provided by Fernando Santagata and Brian Duggan.</p>
<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/tim-smith/perl6/ch-1.p6">Tim Smith</a> used another so-called <a href="http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/spigot.pdf">spigot algorithm</a> like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Perl6" data-lang="Perl6"><span style="color:#75715e">#| http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/spigot.pdf</span>
<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">gibbons</span>-spigot() {
    <span style="color:#66d9ef">my</span> ($q, $r, $t, $i) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">2</span>;
    gather loop {
        <span style="color:#66d9ef">my</span> $u <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> $i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> $i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>);
        <span style="color:#66d9ef">my</span> $y <span style="color:#f92672">=</span> floor(($q <span style="color:#f92672">*</span> (<span style="color:#ae81ff">27</span> <span style="color:#f92672">*</span> $i <span style="color:#f92672">-</span> <span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> $r) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> $t));

        take $y;

        ($q, $r, $t, $i) <span style="color:#f92672">=</span>
            <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> $q <span style="color:#f92672">*</span> $i <span style="color:#f92672">*</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> $i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>),
            <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> $u <span style="color:#f92672">*</span> ($q <span style="color:#f92672">*</span> (<span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> $i <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> $r <span style="color:#f92672">-</span> $y <span style="color:#f92672">*</span> $t),
            $t <span style="color:#f92672">*</span> $u,
            $i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
    }
}
</code></pre></div><hr>
<hr>
<h2 id="see-also">SEE ALSO</h2>
<hr>
<hr>
<p>Four blog posts on the subject:</p>
<ul>
<li>
<p>Mark Senn: <a href="http://engineering.purdue.edu/~mark/pwc-004.pdf;">http://engineering.purdue.edu/~mark/pwc-004.pdf;</a></p>
</li>
<li>
<p>Arne Sommer: <a href="https://perl6.eu/piermutations.html;">https://perl6.eu/piermutations.html;</a></p>
</li>
<li>
<p>Simon Proctor: <a href="https://www.khanate.co.uk/blog/2019/04/21/perl-weekly-week-4/;">https://www.khanate.co.uk/blog/2019/04/21/perl-weekly-week-4/;</a></p>
</li>
<li>
<p>Jo Christian Oterhals: <a href="https://medium.com/@jcoterhals/perl-6-small-stuff-17-a-weekly-challenge-of-big-pis-bags-and-modules-6c6c0867cb0a">https://medium.com/@jcoterhals/perl-6-small-stuff-17-a-weekly-challenge-of-big-pis-bags-and-modules-6c6c0867cb0a</a>.</p>
</li>
</ul>
<h2 id="wrapping-up">Wrapping up</h2>
<p>Please let me know if I forgot any of the challengers or if you think my explanation of your code misses something important (send me an e-mail or just raise an issue against this GitHub page).</p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        2019 - 2024
                    </span> The Weekly Challenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" rel="noreferrer" rel="noreferrer" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" rel="noreferrer" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://theweeklychallenge.org/plugins/jquery/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://theweeklychallenge.org/plugins/form-validation/jquery.form.min.js"></script>
<script src="https://theweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://theweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://theweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://theweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/chart.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/pwc-challenge.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/gc-challenge.js"></script>
<!-- wow js -->
<script src="https://theweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://theweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://theweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://theweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CJTPYM9SB8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CJTPYM9SB8');
</script>
</body>

</html>

