<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="The Weekly Challenge: Advent Calendar - December 17, 2019"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://theweeklychallenge.org/blog/advent-calendar-2019-12-17/"/>
    <meta property="og:image"       content="https://theweeklychallenge.org/images/blog/2019-12-17.jpg"/>
    <meta property="og:description" content="Advent Calendar - December 17, 2019"/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://theweeklychallenge.org/images/blog/2019-12-17.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Advent Calendar - December 17, 2019">
    <meta name="author" content="The Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.67.0-DEV" />

    <link rel="me" href="https://fosstodon.org/@manwar">
    <link rel="canonical" href="https://theweeklychallenge.org/blog/advent-calendar-2019-12-17/" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Advent Calendar - December 17, 2019</title>
    <link rel="icon" href="https://theweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://theweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- Google fonts -->
    <link href='https://fonts.googleapis.com/css?family=Source Code Pro' rel='stylesheet'>
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://theweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://theweeklychallenge.org/css/main.css">

    <style>
        #goTopButton {
            display: none;          
            position: fixed;        
            bottom: 20px;           
            right: 30px;            
            z-index: 99;            
            border: none;           
            outline: none;          
            background-color: red;  
            color: white;           
            cursor: pointer;        
            padding: 15px;          
            border-radius: 10px;    
            font-size: 18px;        
        }

        #goTopButton:hover {
              background-color: #555;
        }
    </style>


</head>

<body>

<button onclick="goTop()" id="goTopButton" title="Go to top">Top</button>

<script>

    topButton = document.getElementById("goTopButton");

    
    window.onscroll = function() { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 40 || document.documentElement.scrollTop > 40) {
            topButton.style.display = "block";
        } else {
            topButton.style.display = "none";
        }
    }

    
    function goTop() {
        document.body.scrollTop = 0; 
        document.documentElement.scrollTop = 0; 
    }

</script>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://theweeklychallenge.org/">
                        <img src="https://theweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://theweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Advent Calendar - December 17, 2019</h2>
                    <div class="portfolio-meta">
                        <span>Tuesday, Dec 17, 2019</span>|
                        <span> Tags:
                            Perl, Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://theweeklychallenge.org/images/blog/2019-12-17.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    <h2 id="advent-calendar-2019blogadvent-calendar-2019"><a href="/blog/advent-calendar-2019"><strong>Advent Calendar 2019</strong></a></h2>
<h3 id="-day-16blogadvent-calendar-2019-12-16--day-17--day-18blogadvent-calendar-2019-12-18-">| <a href="/blog/advent-calendar-2019-12-16"><strong>Day 16</strong></a> | <strong>Day 17</strong> | <a href="/blog/advent-calendar-2019-12-18"><strong>Day 18</strong></a> |</h3>
<hr>
<p>The gift is presented by <a href="/blog/meet-the-champion-023"><strong>Athanasius</strong></a>. Today he is talking about his solutions to <strong>Task #2: Bitcoin Validation</strong> of <strong><a href="/blog/perl-weekly-challenge-016">&ldquo;The Weekly Challenge - 016&rdquo;</a></strong>.</p>
<h4 id="write-a-script-to-validate-a-given-bitcoin-address-most-bitcoin-addresses-are-34-characters-they-consist-of-random-digits-and-uppercase-and-lowercase-letters-with-the-exception-that-the-uppercase-letter-o-uppercase-letter-i-lowercase-letter-l-and-the-number-0-are-never-used-to-prevent-visual-ambiguity-a-bitcoin-address-encodes-25-bytes-the-last-four-bytes-are-a-checksum-check-they-are-the-first-four-bytes-of-a-double-sha-256-digest-of-the-previous-21-bytes-for-more-information-please-refer-wiki-pagehttpsenbitcoinitwikiaddress">Write a script to validate a given bitcoin address. Most Bitcoin addresses are 34 characters. They consist of random digits and uppercase and lowercase letters, with the exception that the uppercase letter “O”, uppercase letter “I”, lowercase letter “l”, and the number “0” are never used to prevent visual ambiguity. A bitcoin address encodes 25 bytes. The last four bytes are a checksum check. They are the first four bytes of a double SHA-256 digest of the previous 21 bytes. For more information, please refer <a href="https://en.bitcoin.it/wiki/Address">wiki page</a>.</h4>
<hr>
<p>Prior to this task I knew nothing about <strong>Bitcoin</strong>; now, I still don’t know much! But I found a useful introduction, <a href="https://learnmeabitcoin.com/"><strong>Learn Me a Bitcoin</strong></a>, which explains the technology basics quite well. (But not the rationale behind the technology. I now understand what Bitcoin mining is, but not why it’s needed; and I know how the difficulty is adjusted to keep the average mining time around 10 minutes, but not why that target is important in the first place.)</p>
<p>From this <a href="https://allprivatekeys.com/bitcoin-address-format"><strong>site</strong></a> it appears that valid Bitcoin addresses can take 3 forms:</p>
<h5 id="1-pubkey-hash-p2pkh-address-with-prefix-1">1) Pubkey hash (P2PKH address) with prefix 1</h5>
<h5 id="2-script-hash-p2sh-address-with-prefix-3">2) Script hash (P2SH address) with prefix 3</h5>
<h5 id="3-segwit-mainnet-p2wpkh-address-with-prefix-bc1">3) SegWit mainnet (P2WPKH address) with prefix bc1</h5>
<p>However, for this exercise I’ve assumed that only <strong>P2PKH</strong> and <strong>P2SH</strong> addresses are included. For the record, details of <strong>P2WPKH</strong> (or <strong>Bech32</strong>) validation can be found <a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki#Bech32"><strong>here</strong></a>.</p>
<h2 id="perl-solution">PERL SOLUTION</h2>
<p>CPAN’s <a href="https://metacpan.org/pod/Digest::SHA"><strong>Digest::SHA</strong></a> module has a nice OO interface and supports many SHA variants including <strong>SHA-256</strong>. For decoding <strong>Base58</strong> using the <strong>Bitcoin alphabet</strong>, module <a href="https://metacpan.org/pod/Crypt::Misc"><strong>Crypt::Misc</strong></a> has the <strong>function decode_b58b()</strong>. After that, it’s just a question of applied logic.</p>
<p>The trickiest part for me was the code to verify the checksum, which required disentangling all the different encodings. The details are given in the comments to <strong>function validate_checksum()</strong>, below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> strict;
<span style="color:#66d9ef">use</span> warnings;
<span style="color:#66d9ef">use</span> Const::Fast;
<span style="color:#66d9ef">use</span> Crypt::Misc <span style="color:#e6db74">qw( decode_b58b )</span>;
<span style="color:#66d9ef">use</span> Digest::SHA;

const <span style="color:#66d9ef">my</span> $DEFAULT_ADDR  <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2&#39;</span>;
const <span style="color:#66d9ef">my</span> %ADDR_FORMATS  <span style="color:#f92672">=&gt;</span> (<span style="color:#ae81ff">1</span>   <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;P2PKH&#39;</span>, <span style="color:#ae81ff">3</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;P2SH&#39;</span>,
                            bc1 <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Bech32&#39;</span>);
const <span style="color:#66d9ef">my</span> $INVALID_CHARS <span style="color:#f92672">=&gt;</span>  <span style="color:#e6db74">qr{([^1-9A-HJ-NP-Za-km-z])}</span>;
const <span style="color:#66d9ef">my</span> $MAX_CHARS     <span style="color:#f92672">=&gt;</span>  <span style="color:#ae81ff">35</span>;
const <span style="color:#66d9ef">my</span> $MIN_CHARS     <span style="color:#f92672">=&gt;</span>  <span style="color:#ae81ff">26</span>;
const <span style="color:#66d9ef">my</span> $SHA_ALGORITHM <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">256</span>;
const <span style="color:#66d9ef">my</span> $TAB           <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;  &#39;</span>;

MAIN:
{
    <span style="color:#66d9ef">my</span> $address <span style="color:#f92672">=</span> $ARGV[<span style="color:#ae81ff">0</span>] <span style="color:#e6db74">//</span> $DEFAULT_ADDR;

    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;\nBitcoin address: \&#34;$address\&#34;\n&#34;</span>;

    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">my</span> $error <span style="color:#f92672">=</span> validate_format($address, <span style="color:#f92672">\</span><span style="color:#66d9ef">my</span> $format))
    {
        <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;${TAB}Format validation FAILED: $error\n&#34;</span>;
    }
    <span style="color:#66d9ef">elsif</span> ($format <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;Bech32&#39;</span>)
    {
        <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;${TAB}Bech32 format not currently supported\n&#34;</span>;
    }
    <span style="color:#66d9ef">else</span>
    {
        <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;${TAB}Format is \&#34;$format\&#34;\n&#34;</span>;

        <span style="color:#66d9ef">if</span> ($error <span style="color:#f92672">=</span> validate_chars($address))
        {
            <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;${TAB}Character validation FAILED: $error\n&#34;</span>;
        }
        <span style="color:#66d9ef">elsif</span> (validate_checksum($address))
        {
            <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;${TAB}Checksum validation PASSED\n&#34;</span>;
        }
        <span style="color:#66d9ef">else</span>
        {
            <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;${TAB}Checksum validation FAILED\n&#34;</span>;
        }
    }
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate_format</span>
{
    <span style="color:#66d9ef">my</span> ($address, $format) <span style="color:#f92672">=</span> @_;
    <span style="color:#66d9ef">my</span>  $error;

    <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">my</span> $prefix (keys %ADDR_FORMATS)
    {
        <span style="color:#66d9ef">if</span> ($address <span style="color:#f92672">=~</span> <span style="color:#e6db74">qr/^$prefix/</span>)
        {
            $$format <span style="color:#f92672">=</span> $ADDR_FORMATS{$prefix};
            <span style="color:#66d9ef">last</span>;
        }
    }

    <span style="color:#66d9ef">unless</span> (defined $$format)
    {
        <span style="color:#66d9ef">my</span> $len <span style="color:#f92672">=</span> substr($address, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;b&#39;</span> ?
                  substr($address, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;c&#39;</span> ? <span style="color:#ae81ff">3</span> : <span style="color:#ae81ff">2</span> : <span style="color:#ae81ff">1</span>;
        $error  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;invalid prefix &#34;&#39;</span> <span style="color:#f92672">.</span> substr($address, <span style="color:#ae81ff">0</span>, $len) <span style="color:#f92672">.</span>
                  <span style="color:#e6db74">&#39;&#34;, unknown format&#39;</span>;
    }

    <span style="color:#66d9ef">return</span> $error;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate_chars</span>
{
    <span style="color:#66d9ef">my</span> ($address) <span style="color:#f92672">=</span> @_;
    <span style="color:#66d9ef">my</span>  $chars    <span style="color:#f92672">=</span> length $address;
    <span style="color:#66d9ef">my</span>  $error;

    <span style="color:#66d9ef">if</span>    ($chars <span style="color:#f92672">&lt;</span> $MIN_CHARS)
    {
        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;invalid length $chars (minimum is $MIN_CHARS)&#34;</span>;
    }
    <span style="color:#66d9ef">elsif</span> ($chars <span style="color:#f92672">&gt;</span> $MAX_CHARS)
    {
        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;invalid length $chars (maximum is $MAX_CHARS)&#34;</span>;
    }
    <span style="color:#66d9ef">elsif</span> ($address <span style="color:#f92672">=~</span> $INVALID_CHARS)
    {
        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;invalid character \&#34;$1\&#34;&#34;</span>;
    }

    <span style="color:#66d9ef">return</span> $error;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate_checksum</span>
{
    <span style="color:#66d9ef">my</span> ($address)  <span style="color:#f92672">=</span> @_;
    <span style="color:#66d9ef">my</span>  $rawdata   <span style="color:#f92672">=</span> decode_b58b($address);      <span style="color:#75715e"># Base58 to bytes</span>
    <span style="color:#66d9ef">my</span>  $hexdata   <span style="color:#f92672">=</span> unpack <span style="color:#e6db74">&#39;H*&#39;</span>, $rawdata;      <span style="color:#75715e"># Bytes  to hex</span>
    <span style="color:#66d9ef">my</span>  $checksum1 <span style="color:#f92672">=</span> substr  $hexdata, <span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>;       <span style="color:#75715e"># Checksum 1 in hex</span>
    <span style="color:#66d9ef">my</span>  $payload   <span style="color:#f92672">=</span> substr  $hexdata,  <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>;   <span style="color:#75715e"># Payload in hex</span>
    <span style="color:#66d9ef">my</span>  $sha_obj   <span style="color:#f92672">=</span> Digest::SHA<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">new</span>($SHA_ALGORITHM);
        $sha_obj<span style="color:#f92672">-&gt;</span>add(pack <span style="color:#e6db74">&#39;H*&#39;</span>, $payload);      <span style="color:#75715e"># Hex to bytes</span>
    <span style="color:#66d9ef">my</span>  $digest1   <span style="color:#f92672">=</span> $sha_obj<span style="color:#f92672">-&gt;</span>hexdigest;        <span style="color:#75715e"># 1st digest in hex</span>
        $sha_obj<span style="color:#f92672">-&gt;</span>add(pack <span style="color:#e6db74">&#39;H*&#39;</span>, $digest1);      <span style="color:#75715e"># hex to bytes</span>
    <span style="color:#66d9ef">my</span>  $digest2   <span style="color:#f92672">=</span> $sha_obj<span style="color:#f92672">-&gt;</span>hexdigest;        <span style="color:#75715e"># 2nd digest in hex</span>
    <span style="color:#66d9ef">my</span>  $checksum2 <span style="color:#f92672">=</span> substr  $digest2,  <span style="color:#ae81ff">0</span>,  <span style="color:#ae81ff">8</span>;   <span style="color:#75715e"># Checksum 2 in hex</span>

    <span style="color:#66d9ef">return</span> $checksum1 <span style="color:#f92672">eq</span> $checksum2;             <span style="color:#75715e"># Compare checksums</span>
}
</code></pre></div><h2 id="raku-solution">RAKU SOLUTION</h2>
<p>I was surprised to find that pack and unpack are still considered experimental in <strong>Raku</strong>. Fortunately, the functionality I needed was available. I found <a href="https://modules.perl6.org/dist/Digest::SHA256::Native:cpan:BDUGGAN"><strong>Digest::SHA256::Native</strong></a> as a replacement for <strong>Perl</strong>’s <strong>Digest::SHA</strong>, but had to re-use the <strong>Perl</strong> module <strong>Crypt::Misc</strong> here.</p>
<p>Note: I created <strong>$decode_b58b</strong> as an alias for <strong>Crypt::Misc::decode_b58b</strong> only to keep Comma happy! This worked (it removed the error message), but I couldn’t find any way to make Comma happy with the call to pack, which is a function only and so can’t be called as a method.</p>
<p>As usual, my approach to <strong>Raku</strong> coding is to use functional-style method calls and explicity-declared variable types wherever possible. This is overkill for a script like this, but it helps me to learn. <strong>Blob[uint8]</strong> was a type I hadn’t come across before. Note also the regex:</p>
<pre><code>rx{ ( &lt;-[1..9A..HJ..NP..Za..km..z]&gt; ) }
</code></pre>
<p>which uses a negated character class <strong>(&lt;-[&hellip;]&gt;)</strong> to match any character outside the allowed Bitcoin address alphabet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl6" data-lang="perl6"><span style="color:#66d9ef">use</span> v6;
<span style="color:#66d9ef">use</span> experimental :pack;
<span style="color:#66d9ef">use</span> Crypt::Misc:from<span style="color:#e6db74">&lt;Perl5&gt;</span> <span style="color:#e6db74">&lt;decode_b58b&gt;</span>;
<span style="color:#66d9ef">use</span> Digest::SHA256::Native;

<span style="color:#66d9ef">my</span> Sub $decode_b58b :<span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>Crypt::Misc::decode_b58b;

<span style="color:#66d9ef">my</span>       constant %ADDR<span style="color:#f92672">-</span>FORMATS  <span style="color:#f92672">=</span>
                  (<span style="color:#ae81ff">1</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;P2PKH&#39;</span>, <span style="color:#ae81ff">3</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;P2SH&#39;</span>, bc1 <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Bech32&#39;</span>);
<span style="color:#66d9ef">my</span> Str   constant $DEFAULT<span style="color:#f92672">-</span>ADDR  <span style="color:#f92672">=</span>
                  <span style="color:#e6db74">&#39;1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2&#39;</span>;
<span style="color:#66d9ef">my</span> Regex constant $INVALID<span style="color:#f92672">-</span>CHARS <span style="color:#f92672">=</span>
                  rx{ ( <span style="color:#e6db74">&lt;-[1..9A..HJ..NP..Za..km..z]&gt;</span> ) };
<span style="color:#66d9ef">my</span> UInt  constant $MAX<span style="color:#f92672">-</span>CHARS     <span style="color:#f92672">=</span>  <span style="color:#ae81ff">35</span>;
<span style="color:#66d9ef">my</span> UInt  constant $MIN<span style="color:#f92672">-</span>CHARS     <span style="color:#f92672">=</span>  <span style="color:#ae81ff">26</span>;
<span style="color:#66d9ef">my</span> Str   constant $TAB           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;  &#39;</span>;

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">MAIN</span>(Str:D $address = $DEFAULT-ADDR)
{
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;\nBitcoin address: \&#34;$address\&#34;\n&#34;</span>;
    <span style="color:#66d9ef">my</span> Str:D $format <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;

    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">my</span> $error <span style="color:#f92672">=</span> validate<span style="color:#f92672">-</span>format($address, $format)
    {
        <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;{$TAB}Format validation FAILED: $error\n&#34;</span>;
    }
    <span style="color:#66d9ef">elsif</span> $format <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;Bech32&#39;</span>
    {
        <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;{$TAB}Bech32 format not currently supported\n&#34;</span>;
    }
    <span style="color:#66d9ef">else</span>
    {
        <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;{$TAB}Format is \&#34;$format\&#34;\n&#34;</span>;

        <span style="color:#66d9ef">if</span> $error <span style="color:#f92672">=</span> validate<span style="color:#f92672">-</span>chars($address)
        {
            <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;{$TAB}Character validation FAILED: $error\n&#34;</span>;
        }
        <span style="color:#66d9ef">elsif</span> validate<span style="color:#f92672">-</span>checksum($address)
        {
            <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;{$TAB}Checksum validation PASSED\n&#34;</span>;
        }
        <span style="color:#66d9ef">else</span>
        {
            <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;{$TAB}Checksum validation FAILED\n&#34;</span>;
        }
    }
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate</span>-format(Str:D $address, Str:D $format is rw)
{
    <span style="color:#66d9ef">my</span> Str $error;

    <span style="color:#66d9ef">for</span> keys %ADDR<span style="color:#f92672">-</span>FORMATS <span style="color:#f92672">-&gt;</span> Str $prefix
    {
        <span style="color:#66d9ef">if</span> $address <span style="color:#f92672">~~</span> <span style="color:#e6db74">/^$prefix/</span>
        {
            $format <span style="color:#f92672">=</span> %ADDR<span style="color:#f92672">-</span>FORMATS{$prefix};
            <span style="color:#66d9ef">last</span>;
        }
    }

    <span style="color:#66d9ef">unless</span> $format
    {
        <span style="color:#66d9ef">my</span> UInt $len <span style="color:#f92672">=</span> $address<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;b&#39;</span> ??
                       $address<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">eq</span> <span style="color:#e6db74">&#39;c&#39;</span> ?? <span style="color:#ae81ff">3</span> <span style="color:#f92672">!!</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">!!</span> <span style="color:#ae81ff">1</span>;

        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;invalid prefix &#34;&#39;</span> <span style="color:#f92672">~</span> $address<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>, $len) <span style="color:#f92672">~</span>
                 <span style="color:#e6db74">&#39;&#34;, unknown format&#39;</span>;
    }

    <span style="color:#66d9ef">return</span> $error;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate</span>-chars(Str:D $address)
{
    <span style="color:#66d9ef">my</span> $chars <span style="color:#f92672">=</span> $address<span style="color:#f92672">.</span>chars;
    <span style="color:#66d9ef">my</span> Str $error;

    <span style="color:#66d9ef">if</span> $chars <span style="color:#f92672">&lt;</span> $MIN<span style="color:#f92672">-</span>CHARS
    {
        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;invalid length $chars (minimum is $MIN-CHARS)&#34;</span>;
    }
    <span style="color:#66d9ef">elsif</span> $chars <span style="color:#f92672">&gt;</span> $MAX<span style="color:#f92672">-</span>CHARS
    {
        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;invalid length $chars (maximum is $MAX-CHARS)&#34;</span>;
    }
    <span style="color:#66d9ef">elsif</span> $address <span style="color:#f92672">~~</span> $INVALID<span style="color:#f92672">-</span>CHARS
    {
        $error <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;invalid character \&#34;$0\&#34;&#34;</span>;
    }

    <span style="color:#66d9ef">return</span> $error;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">validate</span>-checksum(Str:D $address)
{
    <span style="color:#66d9ef">my</span> Blob[uint8] $raw<span style="color:#f92672">-</span>data      <span style="color:#f92672">=</span> $decode_b58b($address);
    <span style="color:#66d9ef">my</span> Str         $hex<span style="color:#f92672">-</span>data      <span style="color:#f92672">=</span> $raw<span style="color:#f92672">-</span>data<span style="color:#f92672">.</span>unpack(<span style="color:#e6db74">&#39;H*&#39;</span>);
    <span style="color:#66d9ef">my</span> Str         $hex<span style="color:#f92672">-</span>checksum1 <span style="color:#f92672">=</span> $hex<span style="color:#f92672">-</span>data<span style="color:#f92672">.</span>substr(<span style="color:#f92672">*-</span><span style="color:#ae81ff">8</span>);
    <span style="color:#66d9ef">my</span> Str         $hex<span style="color:#f92672">-</span>payload   <span style="color:#f92672">=</span> $hex<span style="color:#f92672">-</span>data<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">*-</span><span style="color:#ae81ff">8</span>);
    <span style="color:#66d9ef">my</span> Blob[uint8] $raw<span style="color:#f92672">-</span>payload   <span style="color:#f92672">=</span> pack(<span style="color:#e6db74">&#39;H*&#39;</span>, $hex<span style="color:#f92672">-</span>payload);
    <span style="color:#66d9ef">my</span> Str         $hex<span style="color:#f92672">-</span>digest1   <span style="color:#f92672">=</span> sha256<span style="color:#f92672">-</span>hex($raw<span style="color:#f92672">-</span>payload);
    <span style="color:#66d9ef">my</span> Blob[uint8] $raw_digest1   <span style="color:#f92672">=</span> pack(<span style="color:#e6db74">&#39;H*&#39;</span>, $hex<span style="color:#f92672">-</span>digest1);
    <span style="color:#66d9ef">my</span> Str         $hex<span style="color:#f92672">-</span>digest2   <span style="color:#f92672">=</span> sha256<span style="color:#f92672">-</span>hex($raw_digest1);
    <span style="color:#66d9ef">my</span> Str         $hex<span style="color:#f92672">-</span>checksum2 <span style="color:#f92672">=</span> $hex<span style="color:#f92672">-</span>digest2<span style="color:#f92672">.</span>substr(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">8</span>);

    <span style="color:#66d9ef">return</span> $hex<span style="color:#f92672">-</span>checksum1 <span style="color:#f92672">eq</span> $hex<span style="color:#f92672">-</span>checksum2;
}
</code></pre></div><hr>
<p>If you have any suggestion then please do share with us <a href="mailto:perlweeklychallenge@yahoo.com">perlweeklychallenge@yahoo.com</a>.</p>
<p><a href="/blog/advent-calendar-2019"><strong>Advent Calendar 2019</strong></a></p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        2019 - 2025
                    </span> The Weekly Challenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" rel="noreferrer" rel="noreferrer" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" rel="noreferrer" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://theweeklychallenge.org/plugins/jquery/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://theweeklychallenge.org/plugins/form-validation/jquery.form.min.js"></script>
<script src="https://theweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://theweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://theweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://theweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/chart.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/pwc-challenge.js"></script>
<script src="https://theweeklychallenge.org/plugins/chart/gc-challenge.js"></script>
<!-- wow js -->
<script src="https://theweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://theweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://theweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://theweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CJTPYM9SB8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CJTPYM9SB8');
</script>
</body>

</html>

